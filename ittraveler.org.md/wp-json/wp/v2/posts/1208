{"id":1208,"date":"2019-03-22T11:08:58","date_gmt":"2019-03-22T08:08:58","guid":{"rendered":"http:\/\/ittraveler.org\/?p=1208"},"modified":"2020-04-26T19:07:03","modified_gmt":"2020-04-26T16:07:03","slug":"kastomizaciya-gostevyx-os-windows-v-kvm-na-primere-proxmox","status":"publish","type":"post","link":"http:\/\/ittraveler.org\/kastomizaciya-gostevyx-os-windows-v-kvm-na-primere-proxmox\/","title":{"rendered":"\u041a\u0430\u0441\u0442\u043e\u043c\u0438\u0437\u0430\u0446\u0438\u044f \u0433\u043e\u0441\u0442\u0435\u0432\u044b\u0445 \u041e\u0421 Windows \u0432 KVM \u043d\u0430 \u043f\u0440\u0438\u043c\u0435\u0440\u0435 Proxmox"},"content":{"rendered":"<p>\u0412 VMware Vsphere \u0435\u0441\u0442\u044c \u0443\u0434\u043e\u0431\u043d\u044b\u0439 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c \u043a\u0430\u0441\u0442\u043e\u043c\u0438\u0437\u0430\u0446\u0438\u0438 \u041e\u0421 \u043f\u0440\u0438 \u0434\u0435\u043f\u043b\u043e\u0435 &#8212; <a href=\"https:\/\/pubs.vmware.com\/vsphere-51\/index.jsp?topic=%2Fcom.vmware.vsphere.vm_admin.doc%2FGUID-7523239A-9BB8-4FAD-88F6-C8701933CA64.html\">OS Customization <\/a><\/p>\n<p>\u0421 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043d\u0435\u0433\u043e \u043c\u043e\u0436\u043d\u043e \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u0432\u0432\u0435\u0441\u0442\u0438 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u0443\u044e \u043c\u0430\u0448\u0438\u043d\u0443 \u0432 \u0434\u043e\u043c\u0435\u043d \u0438\u043b\u0438 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043a\u0440\u0438\u043f\u0442\u044b \u043f\u043e\u0441\u043b\u0435 \u0434\u0435\u043f\u043b\u043e\u044f.<\/p>\n<p>\u042d\u0442\u043e \u043e\u0447\u0435\u043d\u044c \u0443\u0434\u043e\u0431\u043d\u043e, \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e \u043f\u0440\u0438 \u0440\u0430\u0437\u0432\u0435\u0440\u0442\u044b\u0432\u0430\u043d\u0438\u0438 \u0441\u043e\u0442\u043d\u0438 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0448\u0438\u043d. \u041f\u043e\u0445\u043e\u0436\u0438\u0439 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c \u0437\u0430\u0445\u043e\u0442\u0435\u043b\u043e\u0441\u044c \u0438\u043c\u0435\u0442\u044c \u0438 \u0432 KVM.<\/p>\n<p>\u0412 \u044d\u0442\u043e\u0439 \u0441\u0442\u0430\u0442\u044c\u0435 \u043c\u044b \u0440\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043a\u0430\u043a \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0442\u044c \u043f\u043e\u0445\u043e\u0436\u0438\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0430\u043b \u043d\u0430 \u043f\u0440\u0438\u043c\u0435\u0440\u0435 Proxmox \u0438 \u0448\u0430\u0431\u043b\u043e\u043d\u0430 Windows<!--more--><\/p>\n<p>\u0414\u043b\u044f \u043d\u0430\u0447\u0430\u043b\u0430 \u043d\u0430\u043c \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u0438\u0442\u044c \u0448\u0430\u0431\u043b\u043e\u043d \u041e\u0421, \u0438\u0437 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u043c\u044b \u0431\u0443\u0434\u0435\u043c \u0434\u0435\u043f\u043b\u043e\u0438\u0442\u044c \u043d\u0430\u0448\u0438 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0435 \u043c\u0430\u0448\u0438\u043d\u044b.<\/p>\n<p>\u0421\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u043d\u043e\u0432\u0443\u044e VM, \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0435 \u043d\u0430 \u043d\u0435\u0435 \u041e\u0421, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 Windows Server 2016.<\/p>\n<p>\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u0435 \u043d\u0430 \u043c\u0430\u0448\u0438\u043d\u0443 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435 \u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430 \u0438 qemu \u0430\u0433\u0435\u043d\u0442, \u043e\u043d \u0435\u0441\u0442\u044c \u0432 \u043e\u0431\u0440\u0430\u0437\u0435 \u0441 <a href=\"https:\/\/www.linux-kvm.org\/page\/WindowsGuestDrivers\/Download_Drivers\">\u0434\u0440\u0430\u0439\u0432\u0435\u0440\u0430\u043c\u0438<\/a><\/p>\n<p>\u041f\u043e\u0441\u043b\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 qemu \u0430\u0433\u0435\u043d\u0442\u0430, \u0441\u043e\u0437\u0434\u0430\u0439\u0442\u0435 \u043b\u043e\u043a\u0430\u043b\u044c\u043d\u0443\u044e \u0443\u0447\u0435\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c, \u043e\u0442\u043a\u0440\u043e\u0439\u0442\u0435 \u0441\u043b\u0443\u0436\u0431\u044b windows \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u0442\u0435 \u0437\u0430\u043f\u0443\u0441\u043a \u0441\u043b\u0443\u0436\u0431\u044b qemu \u0430\u0433\u0435\u043d\u0442 \u043d\u0435 \u043e\u0442 local system, \u0430 \u043e\u0442 \u0440\u0430\u043d\u0435\u0435 \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u043e\u0439 \u0423\u0417<\/p>\n<p><img loading=\"lazy\" class=\"alignnone wp-image-1214\" src=\"http:\/\/ittraveler.org\/wp-content\/uploads\/2020\/04\/qumu-service_o7hqdy.png\" width=\"357\" height=\"226\" \/><\/p>\n<p>\u0422\u0435\u043f\u0435\u0440\u044c \u043d\u0443\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u043d\u0430 \u043c\u0430\u0448\u0438\u043d\u0435 sysprep \u0441 \u0444\u0430\u0439\u043b\u043e\u043c \u043e\u0442\u0432\u0435\u0442\u0430.<\/p>\n<p>\u042f \u0431\u0443\u0434\u0443 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0444\u0430\u0439\u043b \u043e\u0442\u0432\u0435\u0442\u0430, \u043c\u043e\u0436\u0435\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0435\u0433\u043e \u043a\u0430\u043a \u043f\u0440\u0438\u043c\u0435\u0440 \u0438\u043b\u0438 \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u0432\u043e\u0439, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 <a href=\"http:\/\/www.windowsafg.com\/server2016.html\">\u0442\u0443\u0442<\/a><\/p>\n<p>\u0444\u0430\u0439\u043b \u043e\u0442\u0432\u0435\u0442\u043e\u0432 unattend.xml<\/p>\n<pre class=\"lang:default decode:true\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\r\n&lt;unattend xmlns=\"urn:schemas-microsoft-com:unattend\"&gt;\r\n&lt;settings pass=\"windowsPE\"&gt;\r\n&lt;component name=\"Microsoft-Windows-International-Core-WinPE\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\"&gt;\r\n&lt;SetupUILanguage&gt;\r\n&lt;UILanguage&gt;en-US&lt;\/UILanguage&gt;\r\n&lt;\/SetupUILanguage&gt;\r\n&lt;InputLocale&gt;0c09:00000409&lt;\/InputLocale&gt;\r\n&lt;SystemLocale&gt;en-US&lt;\/SystemLocale&gt;\r\n&lt;UILanguage&gt;en-US&lt;\/UILanguage&gt;\r\n&lt;UILanguageFallback&gt;en-US&lt;\/UILanguageFallback&gt;\r\n&lt;UserLocale&gt;en-US&lt;\/UserLocale&gt;\r\n&lt;\/component&gt;\r\n&lt;component name=\"Microsoft-Windows-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\"&gt;\r\n&lt;ImageInstall&gt;\r\n&lt;OSImage&gt;\r\n&lt;InstallTo&gt;\r\n&lt;DiskID&gt;0&lt;\/DiskID&gt;\r\n&lt;PartitionID&gt;2&lt;\/PartitionID&gt;\r\n&lt;\/InstallTo&gt;\r\n&lt;\/OSImage&gt;\r\n&lt;\/ImageInstall&gt;\r\n&lt;UserData&gt;\r\n&lt;AcceptEula&gt;true&lt;\/AcceptEula&gt;\r\n&lt;FullName&gt;admin&lt;\/FullName&gt;\r\n&lt;Organization&gt;&lt;\/Organization&gt;\r\n&lt;ProductKey&gt;\r\n&lt;Key&gt;WC2BQ-8NRM3-FDDYY-2BFGV-KHKQY&lt;\/Key&gt;\r\n&lt;\/ProductKey&gt;\r\n&lt;\/UserData&gt;\r\n&lt;EnableFirewall&gt;true&lt;\/EnableFirewall&gt;\r\n&lt;RunSynchronous&gt;\r\n&lt;RunSynchronousCommand wcm:action=\"add\"&gt;\r\n&lt;Order&gt;1&lt;\/Order&gt;\r\n&lt;Path&gt;net user administrator \/active:yes&lt;\/Path&gt;\r\n&lt;\/RunSynchronousCommand&gt;\r\n&lt;\/RunSynchronous&gt;\r\n&lt;\/component&gt;\r\n&lt;\/settings&gt;\r\n&lt;settings pass=\"offlineServicing\"&gt;\r\n&lt;component name=\"Microsoft-Windows-LUA-Settings\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\"&gt;\r\n&lt;EnableLUA&gt;false&lt;\/EnableLUA&gt;\r\n&lt;\/component&gt;\r\n&lt;\/settings&gt;\r\n&lt;settings pass=\"generalize\"&gt;\r\n&lt;component name=\"Microsoft-Windows-Security-SPP\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\"&gt;\r\n&lt;SkipRearm&gt;1&lt;\/SkipRearm&gt;\r\n&lt;\/component&gt;\r\n&lt;\/settings&gt;\r\n&lt;settings pass=\"specialize\"&gt;\r\n&lt;component name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\"&gt;\r\n&lt;InputLocale&gt;0c09:00000409&lt;\/InputLocale&gt;\r\n&lt;SystemLocale&gt;en-AU&lt;\/SystemLocale&gt;\r\n&lt;UILanguage&gt;en-AU&lt;\/UILanguage&gt;\r\n&lt;UILanguageFallback&gt;en-AU&lt;\/UILanguageFallback&gt;\r\n&lt;UserLocale&gt;en-AU&lt;\/UserLocale&gt;\r\n&lt;\/component&gt;\r\n&lt;component name=\"Microsoft-Windows-Security-SPP-UX\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\"&gt;\r\n&lt;SkipAutoActivation&gt;true&lt;\/SkipAutoActivation&gt;\r\n&lt;\/component&gt;\r\n&lt;component name=\"Microsoft-Windows-SQMApi\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\"&gt;\r\n&lt;CEIPEnabled&gt;0&lt;\/CEIPEnabled&gt;\r\n&lt;\/component&gt;\r\n&lt;component name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\"&gt;\r\n&lt;ComputerName&gt;srv1&lt;\/ComputerName&gt;\r\n&lt;\/component&gt;\r\n&lt;\/settings&gt;\r\n&lt;settings pass=\"oobeSystem\"&gt;\r\n&lt;component name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\"&gt;\r\n&lt;AutoLogon&gt;\r\n&lt;Password&gt;\r\n&lt;Value&gt;PASS&lt;\/Value&gt;\r\n&lt;PlainText&gt;true&lt;\/PlainText&gt;\r\n&lt;\/Password&gt;\r\n&lt;Enabled&gt;true&lt;\/Enabled&gt;\r\n&lt;Username&gt;administrator&lt;\/Username&gt;\r\n&lt;\/AutoLogon&gt;\r\n&lt;OOBE&gt;\r\n&lt;HideEULAPage&gt;true&lt;\/HideEULAPage&gt;\r\n&lt;HideLocalAccountScreen&gt;true&lt;\/HideLocalAccountScreen&gt;\r\n&lt;HideOEMRegistrationScreen&gt;true&lt;\/HideOEMRegistrationScreen&gt;\r\n&lt;HideOnlineAccountScreens&gt;true&lt;\/HideOnlineAccountScreens&gt;\r\n&lt;HideWirelessSetupInOOBE&gt;true&lt;\/HideWirelessSetupInOOBE&gt;\r\n&lt;NetworkLocation&gt;Work&lt;\/NetworkLocation&gt;\r\n&lt;ProtectYourPC&gt;1&lt;\/ProtectYourPC&gt;\r\n&lt;SkipMachineOOBE&gt;true&lt;\/SkipMachineOOBE&gt;\r\n&lt;SkipUserOOBE&gt;true&lt;\/SkipUserOOBE&gt;\r\n&lt;\/OOBE&gt;\r\n&lt;UserAccounts&gt;\r\n&lt;AdministratorPassword&gt;\r\n&lt;Value&gt;RooTqwerty123&lt;\/Value&gt;\r\n&lt;PlainText&gt;true&lt;\/PlainText&gt;\r\n&lt;\/AdministratorPassword&gt;\r\n&lt;LocalAccounts&gt;\r\n&lt;LocalAccount wcm:action=\"add\"&gt;\r\n&lt;Description&gt;admin&lt;\/Description&gt;\r\n&lt;DisplayName&gt;admin&lt;\/DisplayName&gt;\r\n&lt;Group&gt;Administrators&lt;\/Group&gt;\r\n&lt;Name&gt;admin&lt;\/Name&gt;\r\n&lt;\/LocalAccount&gt;\r\n&lt;LocalAccount wcm:action=\"add\"&gt;\r\n&lt;Password&gt;\r\n&lt;Value&gt;PasswordGoesHere&lt;\/Value&gt;\r\n&lt;PlainText&gt;true&lt;\/PlainText&gt;\r\n&lt;\/Password&gt;\r\n&lt;Description&gt;Local Administrator&lt;\/Description&gt;\r\n&lt;DisplayName&gt;Administrator&lt;\/DisplayName&gt;\r\n&lt;Group&gt;Administrators&lt;\/Group&gt;\r\n&lt;Name&gt;Administrator&lt;\/Name&gt;\r\n&lt;\/LocalAccount&gt;\r\n&lt;\/LocalAccounts&gt;\r\n&lt;\/UserAccounts&gt;\r\n&lt;RegisteredOrganization&gt;&lt;\/RegisteredOrganization&gt;\r\n&lt;RegisteredOwner&gt;admin&lt;\/RegisteredOwner&gt;\r\n&lt;DisableAutoDaylightTimeSet&gt;false&lt;\/DisableAutoDaylightTimeSet&gt;\r\n&lt;TimeZone&gt;Russian Standard Time&lt;\/TimeZone&gt;\r\n&lt;\/component&gt;\r\n&lt;\/settings&gt;\r\n&lt;\/unattend&gt;<\/pre>\n<p>\u0422\u0435\u043f\u0435\u0440\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u0435 \u044d\u0442\u043e\u0442 \u0444\u0430\u0439\u043b \u043d\u0430 \u0441\u0432\u043e\u0435\u0439 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u0439 \u043c\u0430\u0448\u0438\u043d\u0435, \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u0432\u044b \u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0442\u043e \u043d\u0430\u0441\u0442\u0440\u043e\u0438\u043b\u0438 \u0438 \u0440\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u043b\u0438 \u0438 \u043f\u043b\u0430\u043d\u0438\u0440\u0443\u0435\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043a\u0430\u043a \u0448\u0430\u0431\u043b\u043e\u043d.<\/p>\n<p>\u0414\u0430\u043b\u0435\u0435 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u0435 \u043d\u0430 \u043d\u0435\u0439 sysprep.<\/p>\n<p>\u043a\u043e\u043c\u0430\u043d\u0434\u0430 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0431\u0443\u0434\u0435\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0430\u044f:<\/p>\n<pre class=\"lang:default decode:true \">sysprep.exe \/generalize \/oobe \/unattend:c:\\unattend.xml \/shutdown<\/pre>\n<p>\u0412\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435 \u044d\u0442\u043e\u0439 \u043a\u043e\u043c\u0430\u043d\u0434\u044b \u043f\u0440\u0438\u043c\u0435\u043d\u0438\u0442 \u0444\u0430\u0439\u043b \u043e\u0442\u0432\u0435\u0442\u043e\u0432 \u0438 \u0432\u044b\u043a\u043b\u044e\u0447\u0438\u0442 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u0443\u044e \u043c\u0430\u0448\u0438\u043d\u0443.<\/p>\n<p>\u041f\u043e\u0441\u043b\u0435 \u044d\u0442\u043e\u0433\u043e \u043e\u043d\u0430 \u0431\u0443\u0434\u0435\u0442 \u0433\u043e\u0442\u043e\u0432\u0430 \u043a \u0434\u0435\u043f\u043b\u043e\u044e.<\/p>\n<p>\u0422\u0435\u043f\u0435\u0440\u044c \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u0443\u0439\u0442\u0435 \u0435\u0435 \u0432 \u0448\u0430\u0431\u043b\u043e\u043d \u0432 \u0432\u0435\u0431 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0435 proxmox<\/p>\n<p><img loading=\"lazy\" class=\"alignnone wp-image-1212\" src=\"http:\/\/ittraveler.org\/wp-content\/uploads\/2020\/04\/vm-to-template_rwaozl.png\" width=\"140\" height=\"227\" \/><\/p>\n<p>&nbsp;<\/p>\n<p>\u041d\u0430 \u044d\u0442\u043e\u043c \u044d\u0442\u0430\u043f\u0435 \u0448\u0430\u0431\u043b\u043e\u043d \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u0433\u043e\u0442\u043e\u0432.<\/p>\n<p>\u0422\u0435\u043f\u0435\u0440\u044c \u043d\u0430\u043c \u043d\u0443\u0436\u0435\u043d \u0441\u043a\u0440\u0438\u043f\u0442 \u0434\u0435\u043f\u043b\u043e\u044f VM \u0441 \u0445\u043e\u0441\u0442\u0430.<\/p>\n<p>\u0421\u043a\u0440\u0438\u043f\u0442 \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0442\u044c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0435\u0435:<\/p>\n<p>1) \u041a\u043b\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c VM \u0438\u0437 \u0448\u0430\u0431\u043b\u043e\u043d\u0430<\/p>\n<p>2) \u0412\u043a\u043b\u044e\u0447\u0430\u0442\u044c VM \u043f\u043e\u0441\u043b\u0435 \u0434\u0435\u043f\u043b\u043e\u044f, \u043f\u0440\u043e\u0432\u0435\u0440\u044f\u0442\u044c \u0437\u0430\u043f\u0443\u0441\u043a qemu \u0430\u0433\u0435\u043d\u0442\u0430 \u0438 \u0432\u0432\u043e\u0434\u0438\u0442\u044c \u043c\u0430\u0448\u0438\u043d\u0443 \u0432 \u0434\u043e\u043c\u0435\u043d Active Directory \u0438\u043b\u0438 \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u044b\u0432\u0430\u0442\u044c.<\/p>\n<p>\u042d\u0442\u043e \u0431\u0443\u0434\u0435\u0442 \u0434\u0435\u043b\u0430\u0442\u044c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0441\u043a\u0440\u0438\u043f\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0443\u0436\u043d\u043e \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0442\u044c \u0441 \u0445\u043e\u0441\u0442\u0430 \u0433\u0438\u043f\u0435\u0440\u0432\u0438\u0437\u043e\u0440\u0430:<\/p>\n<pre class=\"lang:default decode:true\">#!\/bin\/bash\r\n\r\n########EXAMPLE\r\n\r\n# .\/deploy.sh 118 testsrv2 testvm join\r\n\r\n# where:\r\n\r\n# 118 - template ID\r\n\r\n# testsrv2 - new virtual machine name\r\n\r\n# testvm - qemu pool name\r\n\r\n# run command to join AD domain inside guest OS\r\n\r\n###############\r\n\r\n########DOMAIN CREDENTIALS\r\n\r\nlogin='administrator'\r\n\r\npassword='RooTqwerty12345'\r\n\r\ndomain='test-temp.local'\r\n\r\n###########################\r\n\r\nvm=$2\r\n\r\ntemplate=$1\r\n\r\nlastid=$(ls \/etc\/pve\/qemu-server\/ | sed s\/.conf\/\/ | tail -n1)\r\n\r\nnewid=$((lastid + 1))\r\n\r\npool=$3\r\n\r\njoin=$4\r\n\r\necho \"##############START_DEPLOY############################\"\r\n\r\necho \"VM ID IS $newid\"\r\n\r\n\r\nif [ \"$pool\" = \"none\" ];\r\n\r\nthen\r\nqm clone $template $newid -name $vm #-pool $pool\r\nelse\r\nqm clone $template $newid -name $vm  -pool $pool\r\nfi\r\n\r\necho \"Clone complete\"\r\necho 'Your VM name is '$vm''\r\n\r\necho \"Start VM - $vm\"\r\n\r\nqm start $newid\r\n\r\n\r\n\r\nwhile [ -n \"$(qm agent $newid ping 2&gt;&amp;1 &gt; \/dev\/null)\" ]; do\r\n  sleep 0.5\r\necho \"Waiting qemu agent on VM - $vm\"\r\ndone\r\n\r\necho \"Waiting guest OS\"\r\n\r\nfor i in {1..240}\r\ndo\r\nleft=$[240 - $i]\r\n   echo \"Waiting guest OS on VM - $vm.\"\r\n   echo \"Time left $left sec..\"\r\n   sleep 1\r\ndone\r\n\r\n\r\necho \"Send command to customize VM - $vm (ASYNC)\"\r\n\r\nif [ -n \"$join\" ];\r\n\r\nthen\r\necho \"Send command to join domain $domain for VM - $vm\"\r\necho '{\"execute\":\"guest-exec\", \"arguments\":{\"path\":\"powershell.exe\",\"arg\":[\"-command\",\"add-computer\", \"-NewName '$vm'\", \"-restart\", \"-DomainName '$domain'\", \"-force\", \"-Credential $(New-Object   System.Management.Automation.PsCredential(\\u0027'$login'\\u0027,$(ConvertTo-SecureString -String \\u0027'$password'\\u0027 -AsPlainText -Force)))\"]}}'  | socat \/var\/run\/qemu-server\/$newid.qga -\r\nelse\r\necho \"Send command to rename hostname on VM - $vm\"\r\necho '{\"execute\":\"guest-exec\", \"arguments\":{\"path\":\"powershell.exe\",\"arg\":[\"-command\",\"rename-computer\", \"-NewName '$vm'\", \"-restart\", \"-force\", \"-LocalCredential $(New-Object   System.Management.Automation.PsCredential(\\u0027'login'\\u0027,$(ConvertTo-SecureString -String \\u0027'$password'\\u0027 -AsPlainText -Force)))\"]}}'  | socat \/var\/run\/qemu-server\/$newid.qga -\r\n\r\nfi\r\n\r\necho \"Deploy VM - $vm - complete\"\r\n\r\necho \"##############COMPLETE############################\"\r\n<\/pre>\n<p>\u041f\u0440\u0438\u043c\u0435\u0440 \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u0441\u043a\u0440\u0438\u043f\u0442\u0430<\/p>\n<p><strong>.\/deploy.sh 118 testsrv2 testvm join<\/strong><\/p>\n<p>\u0413\u0434\u0435:<\/p>\n<p>118 &#8212; ID \u0440\u0430\u043d\u0435\u0435 \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0448\u0430\u0431\u043b\u043e\u043d\u0430<\/p>\n<p>testsrv2 &#8212; \u0438\u043c\u044f \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0435\u043c\u043e\u0439 VM<\/p>\n<p>testvm &#8212; \u0438\u043c\u044f \u0440\u0435\u0441\u0443\u0440\u0441\u043d\u043e\u0433\u043e \u043f\u0443\u043b\u0430 qemu (\u0435\u0441\u043b\u0438 \u043d\u0435 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043c\u0430\u0448\u0438\u043d \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u043e \u0441\u043a\u043b\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u043d\u0430 \u0442\u043e\u0442 \u0436\u0435 \u0445\u043e\u0441\u0442)<\/p>\n<p>join &#8212; \u0432\u0432\u043e\u0434 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u0439 \u043c\u0430\u0448\u0438\u043d\u044b \u0432 \u0434\u043e\u043c\u0435\u043d \u043f\u043e\u0441\u043b\u0435 \u043a\u043b\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f (\u0435\u0441\u043b\u0438 \u043d\u0435 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043c\u0430\u0448\u0438\u043d\u0430 \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0430, \u0431\u0435\u0437 \u0432\u0432\u043e\u0434\u0430 \u0432 \u0434\u043e\u043c\u0435\u043d)<\/p>\n<p>\u0412 \u0441\u0435\u043a\u0446\u0438\u0438 \u043d\u0438\u0436\u0435 \u0438\u0437\u043c\u0435\u043d\u0438\u0442\u0435 \u0443\u0447\u0435\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a \u0434\u043e\u043c\u0435\u043d\u0443 \u0438 \u0435\u0433\u043e \u0430\u0434\u0440\u0435\u0441:<\/p>\n<pre class=\"lang:default decode:true \">########DOMAIN CREDENTIALS\r\n\r\nlogin='administrator'\r\n\r\npassword='RooTqwerty12345'\r\n\r\ndomain='test-temp.local'\r\n\r\n###########################<\/pre>\n<p>\u0422\u0430\u043a\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c \u043c\u043e\u0436\u043d\u043e \u0440\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0438 \u043a\u0430\u0441\u0442\u043e\u043c\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c VM \u043f\u043e \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0438 \u0441 VMware Guest Customization.<\/p>\n<p>\u041d\u043e \u0435\u0441\u043b\u0438 \u043d\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0440\u0430\u0437\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u043d\u0435 \u043e\u0434\u043d\u0443 \u0430 10 \u0438\u043b\u0438 100 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0448\u0438\u043d?<\/p>\n<p>\u0414\u043e\u0431\u0430\u0432\u0438\u043c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439 \u0441\u043a\u0440\u0438\u043f\u0442 \u0434\u043b\u044f \u0437\u0430\u043f\u0443\u0441\u043a\u0430 \u044d\u0442\u043e\u0433\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430:<\/p>\n<pre class=\"lang:default decode:true\">#!\/bin\/bash\r\n\r\n######EXAMPLE\r\n\r\n# .\/start_deploy.sh 118 testvm join\r\n\r\n# where:\r\n\r\n# 118 - template ID\r\n# testvm - qemu pool name\r\n# join - run join to AD domain command inside guest os\r\n\r\n# add vms names to file vms.list\r\n\r\n#############\r\n\r\nSTART=$(date +%s)\r\n\r\nfile=.\/vms.list\r\n\r\ntemplate=$1\r\n\r\npool=$2\r\n\r\njoin=$3\r\n\r\nwhile IFS='' read -r line || [[ -n \"$line\" ]]; do\r\n\r\n\r\n    echo \"Start job for VM - $line\"\r\n\r\n.\/deploy.sh $template $line $pool $join\r\n\r\n\r\n\r\ndone &lt; \"$file\"\r\n\r\nEND=$(date +%s)\r\nDIFF=$(( $END - $START ))\r\nDIFFMIN=$[$DIFF \/ 60]\r\necho \"Deploy time - $DIFFMIN minutes\"\r\n<\/pre>\n<p>\u041f\u0440\u0438\u043c\u0435\u0440 \u0437\u0430\u043f\u0443\u0441\u043a\u0430:<\/p>\n<p><strong>.\/start_deploy.sh 118 testvm join<\/strong><\/p>\n<p>\u0413\u0434\u0435:<\/p>\n<p>118 &#8212; ID \u0440\u0430\u043d\u0435\u0435 \u0441\u043e\u0437\u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0448\u0430\u0431\u043b\u043e\u043d\u0430<br \/>\ntestvm &#8212; \u0438\u043c\u044f \u0440\u0435\u0441\u0443\u0440\u0441\u043d\u043e\u0433\u043e \u043f\u0443\u043b\u0430 qemu (\u0435\u0441\u043b\u0438 \u043d\u0435 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043c\u0430\u0448\u0438\u043d \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u043e \u0441\u043a\u043b\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u043d\u0430 \u0442\u043e\u0442 \u0436\u0435 \u0445\u043e\u0441\u0442)<br \/>\njoin &#8212; \u0432\u0432\u043e\u0434 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u043e\u0439 \u043c\u0430\u0448\u0438\u043d\u044b \u0432 \u0434\u043e\u043c\u0435\u043d \u043f\u043e\u0441\u043b\u0435 \u043a\u043b\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f (\u0435\u0441\u043b\u0438 \u043d\u0435 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043c\u0430\u0448\u0438\u043d\u0430 \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0441\u0442\u043e \u043f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0430, \u0431\u0435\u0437 \u0432\u0432\u043e\u0434\u0430 \u0432 \u0434\u043e\u043c\u0435\u043d)<\/p>\n<p>\u041f\u043e\u0441\u0442\u0440\u043e\u0447\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a VM \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u0435 \u0432 \u0444\u0430\u0439\u043b\u0435 vms.list<\/p>\n<p>\u0422\u0435\u043f\u0435\u0440\u044c \u0432\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0435\u043f\u043b\u043e\u0439 \u0432\u0430\u0448\u0438\u0445 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0448\u0438\u043d \u043d\u0430 \u0431\u0430\u0437\u0435 Windows \u0432 KVM.<\/p>\n<p>\u041f\u0440\u043e\u0446\u0435\u0441\u0441 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043a\u043e\u043d\u0435\u0447\u043d\u043e \u043e\u0442\u043b\u0438\u0447\u0430\u0435\u0442\u0441\u044f \u043e\u0442 VMware, \u043d\u043e \u043d\u0430 \u0442\u043e \u043e\u043d \u0438 open source.<\/p>\n<p>&nbsp;<\/p>\n","protected":false},"excerpt":{"rendered":"<p>\u0412 VMware Vsphere \u0435\u0441\u0442\u044c \u0443\u0434\u043e\u0431\u043d\u044b\u0439 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c \u043a\u0430\u0441\u0442\u043e\u043c\u0438\u0437\u0430\u0446\u0438\u0438 \u041e\u0421 \u043f\u0440\u0438 \u0434\u0435\u043f\u043b\u043e\u0435 &#8212; OS Customization \u0421 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043d\u0435\u0433\u043e \u043c\u043e\u0436\u043d\u043e \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u0432\u0432\u0435\u0441\u0442\u0438 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u0443\u044e \u043c\u0430\u0448\u0438\u043d\u0443 \u0432 \u0434\u043e\u043c\u0435\u043d \u0438\u043b\u0438 \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0441\u043a\u0440\u0438\u043f\u0442\u044b \u043f\u043e\u0441\u043b\u0435 \u0434\u0435\u043f\u043b\u043e\u044f. \u042d\u0442\u043e \u043e\u0447\u0435\u043d\u044c \u0443\u0434\u043e\u0431\u043d\u043e, \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e \u043f\u0440\u0438 \u0440\u0430\u0437\u0432\u0435\u0440\u0442\u044b\u0432\u0430\u043d\u0438\u0438 \u0441\u043e\u0442\u043d\u0438 \u0432\u0438\u0440\u0442\u0443\u0430\u043b\u044c\u043d\u044b\u0445 \u043c\u0430\u0448\u0438\u043d. \u041f\u043e\u0445\u043e\u0436\u0438\u0439 \u043c\u0435\u0445\u0430\u043d\u0438\u0437\u043c \u0437\u0430\u0445\u043e\u0442\u0435\u043b\u043e\u0441\u044c \u0438\u043c\u0435\u0442\u044c \u0438 \u0432 KVM. \u0412 \u044d\u0442\u043e\u0439 \u0441\u0442\u0430\u0442\u044c\u0435 \u043c\u044b \u0440\u0430\u0441\u0441\u043c\u043e\u0442\u0440\u0438\u043c \u043a\u0430\u043a \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0438\u0442\u044c \u043f\u043e\u0445\u043e\u0436\u0438\u0439 \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0430\u043b \u043d\u0430 \u043f\u0440\u0438\u043c\u0435\u0440\u0435<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[13,8,23,3,1,53],"tags":[],"aioseo_notices":[],"_links":{"self":[{"href":"http:\/\/ittraveler.org\/wp-json\/wp\/v2\/posts\/1208"}],"collection":[{"href":"http:\/\/ittraveler.org\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/ittraveler.org\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/ittraveler.org\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/ittraveler.org\/wp-json\/wp\/v2\/comments?post=1208"}],"version-history":[{"count":15,"href":"http:\/\/ittraveler.org\/wp-json\/wp\/v2\/posts\/1208\/revisions"}],"predecessor-version":[{"id":1333,"href":"http:\/\/ittraveler.org\/wp-json\/wp\/v2\/posts\/1208\/revisions\/1333"}],"wp:attachment":[{"href":"http:\/\/ittraveler.org\/wp-json\/wp\/v2\/media?parent=1208"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/ittraveler.org\/wp-json\/wp\/v2\/categories?post=1208"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/ittraveler.org\/wp-json\/wp\/v2\/tags?post=1208"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}