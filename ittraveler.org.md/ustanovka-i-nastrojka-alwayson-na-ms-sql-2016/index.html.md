# Установка и настройка AlwaysOn на MS SQL 2016                	  
***Дата: 12.06.2019 Автор Admin***

В данной статье мы рассмотрим установку MS SQL 2016 в режиме AlwaysOn на двух нодах Windows Server 2016
Для начала нам нужно 2 сервера Windows Server 2016 в домене AD.
На каждом сервере должны быть отдельные диски для хранения БД, логов и TempDB.
Откройте диспетчер дисков и отформатируйте каждый диск в NTFS и задайте размер кластера 64kb
Должно получиться так:
Далее установите на оба сервера фичу failover clustering.
&nbsp;
Теперь запускаем Failover Cluster manager и создаем кластер, общее хранилище для него нам не нужно.
&nbsp;
&nbsp;
&nbsp;
&nbsp;
После прохождения всех проверок переходим к следующим шагам.
Создаем кластер.
&nbsp;
&nbsp;
&nbsp;
&nbsp;
Теперь нужно добавить witness для созданного кластера
&nbsp;
&nbsp;
Теперь кворум успешно настроен.
&nbsp;
&nbsp;
Теперь установите SQL сервер на обе ноды кластера.
Создайте инстанс по умоланию или создайте инстанс с другим именем.
Укажите доменные сервисные учетные записи вместо локальных
Укажите Collation, обратите внимание что он должен быть одинаковым на всех нодах
Укажите администраторов
&nbsp;
Укажите расположение директорий для БД, tempdb и логов (их нужно расположить на ранее подготовленных дисках)
&nbsp;
Дожидаемся завершения установки
&nbsp;
&nbsp;
Далее открываем SQL Server Configuration Manager, щелкаем правой кнопкой мыши по SQL Server и выбираем properties.
Открываем вкладку Always On и ставим галочку
Выполняем эту процедуру на каждом сервере.
Теперь скачиваем SQL Management Studio по этой ссылке 
Создайте или импортируйте базу данных на одном из серверов.
Теперь перейдем к настройке AlwaysOn
Запускаем Management Studio на одном из серверов и запускаем New Availability Group Wizard
Указываем имя новой AG группы
&nbsp;
Выбираем нашу базу, для которой собственно мы и настраиваем AlwaysOn.
Обратите внимание что база должна иметь модель восстановления full и иметь один полный бэкап
&nbsp;
Добавляем второй сервер и настраиваем все следующим образом
&nbsp;
Далее добавляем Listner, если ваши приложения, подключающиеся к кластеру не умеют multi subnet availability group, в моем случае ноды сервера расположены в разных ДЦ, соответственно и сети у них разные.
Чтобы подключиться к БД приложения должны использовать dns имя listner-а.
Выбираем тип синхронизации full и отказоустойчивую шару для этого, желательно расположенную на отказоустойчивом кластере.
Проверяем что все настроено корректно и выполняем создание группы
На этом настройка AlwaysOn завершена, теперь Ваш SQL сервер может пережить отказ одной из нод, также Вы можете спокойно проводить обслуживание сервера, переключая ноды между собой.
&nbsp;
Переключать AlwaysON группу между нодами можно следующим образом:
Выбираем failover
&nbsp;
Выбираем вторую ноду
&nbsp;
Проверяем выбранные данные и запускаем переключение
&nbsp;
Переключение успешно завершено
&nbsp;
&nbsp;
&nbsp;
